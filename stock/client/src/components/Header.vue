<template>
  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <router-link class="image is-48x48 my-auto" to="/">
        <img :src="GoodsIcon" />
      </router-link>
      <router-link class="is-hidden-mobile title my-auto" to="/">
        令和証券
      </router-link>
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbar" :class="{ 'is-active': burgerVisibillity }" @click="burgerVisibillity=!burgerVisibillity">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="navbar" class="navbar-menu" :class="{ 'is-active': burgerVisibillity }">
      <div class="navbar-start">
        <router-link class="navbar-item" to="/Item">商品</router-link>
         <router-link class="navbar-item" to="/Shop">ショップ</router-link> 
         <router-link class="navbar-item" to="/Map">マップ</router-link> 
      </div>
      <div class="navbar-end">
        <div v-if="userStore.isSignin" class="navbar-item has-dropdown is-hoverable">
          <router-link class="navbar-link" to="/Settings">
            <figure class="m-auto image is-24x24">
              <img :src="userStore.userIcon" @error="changeIconNF" />
            </figure>
          </router-link>
          <div class="navbar-dropdown">
            <router-link class="navbar-item" to="/Settings">設定</router-link>
            <a class="navbar-item" @click="showSignoutDialog()">サインアウト</a>
          </div>
        </div>
        <div v-else class="navbar-item">
          <div class="buttons">
            <o-button variant="primary" @click="showSigninDialog()">サインイン</o-button>
            <o-button variant="info" tag="router-link" to="/Signup">新規登録</o-button>
          </div>
        </div>
      </div>
    </div>
  </nav>
</template>

<script lang="ts" setup>
import { ref, watch } from 'vue'
import { useProgrammatic } from '@oruga-ui/oruga-next'
import Confirm from '../components/dialog/Confirm.vue'
import Login from '../components/auth-dialog/Signin.vue'
// import GoodsIcon from '../assets/logo.png'
import NotFoundIcon from '../assets/user-default.png';
import { useUserStore } from '../store/user';

const userStore = useUserStore()
const burgerVisibillity=ref(false)
const { oruga } = useProgrammatic()

const changeIconNF = async () => {
  userStore.userIcon =NotFoundIcon
}

const showSignoutDialog=async () => {
  const instance = oruga.modal.open({
    component: Confirm,
    props: {
      title: '確認',
      message: '本当にサインアウトしてもよろしいですか?'
    },
    trapFocus: true,
  })
  const result = await instance.promise
  if(result.action=="confirm"){
    await userStore.signOut()
  }
}

const showSigninDialog=async () => {
  oruga.modal.open({
    component: Login,
    props: {
      reason:"button"
    },
    trapFocus: true,
  })
}

</script>

<style>
</style>