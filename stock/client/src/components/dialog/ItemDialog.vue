<template>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">商品詳細</p>
    </header>
    <section class="modal-card-body">
      <ItemEditor ref="edit" :item="props.item" v-if="props.editable"></ItemEditor>
      <ItemViewer :item="props.item" v-else></ItemViewer>
    </section>
    <footer class="modal-card-foot" v-if="props.editable" >
      <o-button class="button is-success" @click="onClick()">登録</o-button>
      <o-button v-if="props.item" class="button is-danger is-right" @click="onDelete()">削除</o-button>
    </footer>
  </div>
</template>
<script setup lang="ts">
import { defineProps, ref } from 'vue';
import { Item } from "../../openapi";
import ItemViewer from "./ItemViewer.vue";
import ItemEditor from "./ItemEditor.vue";

const edit=ref<InstanceType<typeof ItemEditor>>();

const props = withDefaults(defineProps<{
  item?:Item,
  editable?:boolean
}>(), {
  editable:false
});
const emit = defineEmits<{(e: 'close', v:{'action':String, 'method':String}):void}>()
const onClick = async () => {
  if(await edit.value?.onSubmit()){
    emit('close', {'action':'submit', 'method':'ok'})
  }
}

const onDelete = async () => {
  await edit.value?.onDelete()
  emit('close', {'action':'cancel', 'method':'cancel'})
}

</script>
<style scoped>

</style>